<div class="d-flex align-items-center justify-content-between mb-3">
  <h3 class="mb-0">Classes</h3>
  <button class="btn btn-primary" (click)="startCreate()">+ New Class</button>
</div>

<!-- Filters -->
<div class="card mb-3">
  <div class="card-body d-flex gap-2 flex-wrap">
    <input class="form-control" style="max-width:240px" placeholder="Search name / room / subject" [(ngModel)]="q">
    <input class="form-control" style="max-width:200px" placeholder="Subject" [(ngModel)]="subjectFilter">
    <input class="form-control" style="max-width:140px" placeholder="TeacherId" [(ngModel)]="teacherFilter">
  </div>
</div>

<!-- Grid -->
<ng-container *ngIf="!loading; else loadingTpl">
  <ng-container *ngIf="filtered().length; else emptyTpl">
    <div class="row g-3">
      <div class="col-xl-3 col-lg-4 col-md-6" *ngFor="let c of filtered()">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="fw-semibold">{{ c.name }}</div>
                <div class="text-muted small" *ngIf="c.section">Section: {{ c.section }}</div>
              </div>
              <span class="badge text-bg-light">{{ c.subject || '—' }}</span>
            </div>

            <div class="mt-2 small">
              <div><strong>Room:</strong> {{ c.room || '—' }}</div>
              <div><strong>Capacity:</strong> {{ c.capacity ?? '—' }}</div>
              <div><strong>TeacherId:</strong> {{ c.teacherId ?? '—' }}</div>
            </div>
          </div>
          <div class="card-footer d-flex justify-content-between">
            <button class="btn btn-sm btn-outline-secondary" (click)="startEdit(c)">Edit</button>
            <button class="btn btn-sm btn-outline-danger" (click)="askRemove(c.id)">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-template #emptyTpl>
    <div class="p-4 text-center text-muted">No classes found.</div>
  </ng-template>
</ng-container>

<ng-template #loadingTpl>
  <div class="card p-4 text-center">Loading…</div>
</ng-template>

<!-- ================= Offcanvas: Create/Edit Class ================= -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="classEditorCanvas" aria-labelledby="classEditorTitle">
  <div class="offcanvas-header">
    <h5 id="classEditorTitle" class="offcanvas-title">
      {{ editingId ? ('Edit Class #' + editingId) : 'Create Class' }}
    </h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close" [disabled]="submitting"></button>
  </div>

  <div class="offcanvas-body">
    <form [formGroup]="form" (ngSubmit)="save()" novalidate>
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Name</label>
          <input class="form-control" formControlName="name">
          <div class="text-danger small" *ngIf="f.name.touched && f.name.invalid">Name is required.</div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Section</label>
          <input class="form-control" formControlName="section">
        </div>

        <div class="col-md-4">
          <label class="form-label">Room</label>
          <input class="form-control" formControlName="room">
        </div>

        <div class="col-md-4">
          <label class="form-label">Capacity</label>
          <input type="number" class="form-control" formControlName="capacity" min="1">
        </div>

        <div class="col-md-4">
          <label class="form-label">Teacher Id</label>
          <input type="number" class="form-control" formControlName="teacherId">
        </div>

        <div class="col-12">
          <label class="form-label">Subject</label>
          <input class="form-control" formControlName="subject">
        </div>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary" [disabled]="submitting || form.invalid">
          {{ editingId ? 'Update' : 'Save' }}
        </button>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas" [disabled]="submitting">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- ================= Confirm Delete Modal ================= -->
<div class="modal fade" id="confirmRemoveModal" tabindex="-1" aria-labelledby="confirmRemoveTitle" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="confirmRemoveTitle" class="modal-title text-danger">Confirm Delete</h5>
        <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">Are you sure you want to delete this class?</div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger" (click)="remove()" [disabled]="!confirmRemoveId">Delete</button>
      </div>
    </div>
  </div>
</div>
